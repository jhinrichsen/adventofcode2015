# Define a yaml template for running a build and then running your tests
.cargo_test_template: &cargo_test
  script:
  - rustc --version
  - cargo --version
  - cargo test --verbose

# Set any required environment variables here
variables:
  RUST_BACKTRACE: 1

# The following test: stages inherit from the test template above and
# configure the image used for the various Rust release trains
test:stable:
  image: "rustdocker/rust:stable"
  <<: *cargo_test

test:beta:
  image: "rustdocker/rust:beta"
  <<: *cargo_test

test:nightly:
  image: "rustdocker/rust:nightly"
  <<: *cargo_test

# Always want to run rustfmt and clippy against our tests, to ensure that
# we aren't using any anti-patterns or failing to follow our style guide
verify:
  image: "guangie88/rustfmt-clippy"
  script:
    - cargo fmt -- --check
    - cargo clippy --all-targets --all-features -- -D warnings
